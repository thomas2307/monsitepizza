<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Calculateur Soir√©e Pizza & Flam's - Liste de courses compl√®te</title>
    <meta name="description" content="Planifiez votre soir√©e Pizza et Tarte Flamb√©e. Ajoutez plusieurs recettes, d√©finissez les quantit√©s et obtenez une liste de courses globale et pr√©cise.">
    
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* --- CSS STYLES --- */
        :root {
            --bg-color: #FAF3E0;
            --text-color: #2D2420;
            --accent-color: #C0392B;
            --secondary-color: #8D6E63;
            --card-bg: #FFFFFF;
            --container-shadow: 0 10px 25px rgba(0,0,0,0.08);
        }

        body {
            font-family: 'Lato', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            background-image: linear-gradient(rgba(250, 243, 224, 0.92), rgba(250, 243, 224, 0.92)), url('https://www.transparenttextures.com/patterns/cream-paper.png');
            line-height: 1.6;
        }

        h1, h2, h3 { font-family: 'Merriweather', serif; color: var(--text-color); }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 12px;
            box-shadow: var(--container-shadow);
            border: 1px solid #EFEBE9;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 20px;
        }

        h1 { margin: 0; font-size: 1.6rem; letter-spacing: -0.5px; }

        .lang-select {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            background: #fff;
            cursor: pointer;
        }

        .ad-banner-top {
            background-color: #f4f4f4;
            border: 1px dashed #bbb;
            text-align: center;
            padding: 10px;
            margin-bottom: 20px;
            font-size: 0.8rem;
            color: #888;
            border-radius: 6px;
        }

        #main-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            transition: opacity 0.3s ease;
        }

        /* --- Zone de commande (Lignes) --- */
        #order-rows-container {
            margin-bottom: 20px;
        }

        .recipe-row {
            display: grid;
            grid-template-columns: 1.5fr 2fr 1fr auto;
            gap: 10px;
            align-items: center;
            background-color: #FDFBF7;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border: 1px solid #EEE;
            transition: background-color 0.2s;
        }

        .recipe-row:hover { background-color: #FFF; border-color: #DDD; }

        .recipe-row label {
            display: none; /* Cach√© visuellement, utile pour screen readers */
        }

        select, input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 0.95rem;
            background: #fff;
        }

        .btn-remove {
            background: none; border: none; color: #999; cursor: pointer; font-size: 1.2rem;
        }
        .btn-remove:hover { color: var(--accent-color); }

        .add-row-container {
            text-align: center;
            margin-bottom: 40px;
        }

        .btn-add {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn-add:hover { background-color: var(--accent-color); }

        /* --- R√©sultats --- */
        .results-header {
            text-align: center;
            background: var(--text-color);
            color: #fff;
            padding: 10px;
            border-radius: 8px 8px 0 0;
            margin-top: 20px;
        }
        
        .results-container { 
            border: 2px solid var(--text-color);
            border-top: none;
            border-radius: 0 0 8px 8px;
            padding: 20px;
            background-color: #fff;
        }

        table { width: 100%; border-collapse: collapse; }
        th, td { text-align: left; padding: 12px 10px; border-bottom: 1px solid #f0f0f0; }
        th { color: #555; font-family: 'Merriweather', serif; font-size: 0.95rem; }
        td.amount-cell { font-weight: 700; color: var(--accent-color); text-align: right; }
        tr.total-row td { border-top: 2px solid #333; font-weight: bold; font-size: 1.1rem; }

        .actions { text-align: center; margin: 30px 0; }
        .btn-print {
            background-color: var(--accent-color);
            color: #fff;
            border: none; padding: 14px 30px; font-size: 1.1rem; border-radius: 50px;
            cursor: pointer; font-weight: bold; box-shadow: 0 4px 10px rgba(192, 57, 43, 0.3);
        }
        .btn-print:hover { transform: translateY(-2px); box-shadow: 0 6px 15px rgba(192, 57, 43, 0.4); }

        .affiliation-section {
            margin-top: 40px; padding: 25px; background-color: #FFF8E1;
            border: 2px dashed var(--secondary-color); border-radius: 12px;
            display: flex; align-items: center; gap: 20px;
        }
        .aff-link {
            color: var(--text-color); text-decoration: none; font-weight: bold; border-bottom: 2px solid var(--text-color);
        }

        /* --- Responsive --- */
        @media (max-width: 600px) {
            .container { padding: 15px; }
            header { flex-direction: column; align-items: flex-start; }
            .recipe-row { 
                grid-template-columns: 1fr; /* Stack on mobile */
                gap: 5px;
                position: relative;
            }
            .btn-remove { 
                position: absolute; top: 10px; right: 10px; 
            }
            .affiliation-section { flex-direction: column; text-align: center; }
        }

        /* --- Print --- */
        @media print {
            body { background: none; padding: 0; color: #000; }
            .container { box-shadow: none; border: none; padding: 0; max-width: 100%; }
            .ad-banner-top, .affiliation-section, .actions, .lang-select, .add-row-container, .btn-remove { display: none !important; }
            #order-rows-container { border-bottom: 1px solid #000; padding-bottom: 20px; }
            .recipe-row { border: none; padding: 5px 0; background: none; grid-template-columns: 1fr 1fr 1fr; }
            .recipe-row select { border: none; appearance: none; font-weight: bold; padding: 0; }
            .recipe-row input { border: none; text-align: left; padding: 0; }
            .results-container { border: 1px solid #000; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1 data-i18n="ui_title">Planificateur Soir√©e Pizza & Flam's</h1>
        <select id="language-select" class="lang-select">
            <option value="en">üá¨üáß EN</option>
            <option value="fr" selected>üá´üá∑ FR</option>
            <option value="it">üáÆüáπ IT</option>
            <option value="de">üá©üá™ DE</option>
            <option value="es">üá™üá∏ ES</option>
        </select>
    </header>

    <div class="ad-banner-top">
        [ESPACE PUBLICITAIRE - Banni√®re Google AdSense]
    </div>

    <img id="main-image" src="" alt="Food Image">

    <div id="order-rows-container">
        </div>

    <div class="add-row-container">
        <button class="btn-add" onclick="addNewRow()">
            <i class="fas fa-plus"></i> <span data-i18n="btn_add_row">Ajouter une ligne</span>
        </button>
    </div>

    <div class="results-header">
        <h2 style="margin:0; color:white; font-size:1.2rem;" data-i18n="ui_total_list">Liste de Courses Totale</h2>
    </div>
    <div class="results-container">
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr><th data-i18n="ui_col_ingredient">Ingr√©dient</th><th data-i18n="ui_col_quantity" style="text-align: right;">Total</th></tr>
                </thead>
                <tbody id="shopping-list-tbody"></tbody>
            </table>
        </div>
    </div>

    <div class="actions">
        <button class="btn-print" onclick="window.print()" data-i18n="btn_print">Imprimer ma Liste üñ®Ô∏è</button>
    </div>

    <div class="affiliation-section">
        <div style="font-size: 2.5rem;">üî•</div>
        <div class="aff-content">
            <h4 data-i18n="aff_title">Cuisson Pro √† la Maison ?</h4>
            <p data-i18n="aff_text">Le secret d'une p√¢te croustillante est la temp√©rature (500¬∞C). Impossible avec un four standard.</p>
            <a href="#" class="aff-link" target="_blank" data-i18n="aff_btn">Voir les Fours √† Pizza (Ooni/Gozney) ></a>
        </div>
    </div>
</div>

<script>
    /* --- CONFIG & DATA --- */

    // 2 Photos Uniques (Haute Qualit√©)
    const IMAGES = {
        pizza: "https://images.unsplash.com/photo-1574071318508-1cdbab80d002?auto=format&fit=crop&w=1000&q=80", // Belle Pizza Napolitaine
        tarte: "https://upload.wikimedia.org/wikipedia/commons/thumb/0/06/Tarte_flamb%C3%A9e_originale.jpg/1000px-Tarte_flamb%C3%A9e_originale.jpg" // Belle Tarte Flamb√©e
    };

    const translations = {
        en: {
            ui_title: "Pizza & Flams Party Planner", btn_add_row: "Add Recipe Row", ui_total_list: "Total Shopping List",
            ui_col_ingredient: "Ingredient", ui_col_quantity: "Total Qty", btn_print: "Print Shopping List üñ®Ô∏è",
            type_pizza: "üçï Italian Pizza", type_tarte: "üî• Flammkuchen (Tarte)",
            aff_title: "Want Restaurant Quality?", aff_text: "Standard ovens can't reach 500¬∞C. You need a specialized oven.", aff_btn: "Check Pizza Ovens >",
            var_margherita: "Margherita", var_reine: "Regina (Ham/Shrooms)", var_pepperoni: "Pepperoni", var_4cheese: "4 Cheeses",
            var_tradition: "Traditional (Bacon)", var_gratinee: "Gratin√©e (Cheese)", var_forestiere: "Foresti√®re (Shrooms)", var_munster: "Munster Cheese",
            // Ingredients
            ing_flour: "Flour (Type 00)", ing_water: "Water", ing_salt: "Salt", ing_yeast: "Fresh Yeast", ing_oil: "Oil",
            ing_sauce_tomato: "Tomato Sauce", ing_mozzarella: "Mozzarella", ing_basil: "Basil", ing_ham: "Cooked Ham",
            ing_mushrooms: "Mushrooms", ing_pepperoni: "Pepperoni", ing_gorgonzola: "Gorgonzola", ing_goat: "Goat Cheese", ing_parmesan: "Parmesan",
            ing_creme_fraiche: "Cr√®me Fra√Æche", ing_fromage_blanc: "Fromage Blanc", ing_lardons: "Bacon/Lardons", ing_onions: "Onions",
            ing_nutmeg: "Nutmeg", ing_emmental: "Emmental", ing_munster: "Munster",
            unit_g: "g", unit_ml: "ml", unit_some: "leaves", unit_pinch: "pinch", unit_slices: "slices"
        },
        fr: {
            ui_title: "Planificateur Soir√©e Pizza & Flam's", btn_add_row: "Ajouter une ligne", ui_total_list: "Liste de Courses Totale",
            ui_col_ingredient: "Ingr√©dient", ui_col_quantity: "Qt√© Totale", btn_print: "Imprimer la liste üñ®Ô∏è",
            type_pizza: "üçï Pizza Italienne", type_tarte: "üî• Tarte Flamb√©e",
            aff_title: "Cuisson Pro √† la Maison ?", aff_text: "Le four domestique ne chauffe pas assez. Il faut un four sp√©cialis√©.", aff_btn: "Voir les Fours √† Pizza >",
            var_margherita: "Margherita", var_reine: "Reine (Jambon/Champis)", var_pepperoni: "Pepperoni", var_4cheese: "4 Fromages",
            var_tradition: "Traditionnelle (Lardons)", var_gratinee: "Gratin√©e (Emmental)", var_forestiere: "Foresti√®re (Champignons)", var_munster: "Au Munster",
            // Ingr√©dients
            ing_flour: "Farine (T55/00)", ing_water: "Eau", ing_salt: "Sel", ing_yeast: "Levure Fra√Æche", ing_oil: "Huile",
            ing_sauce_tomato: "Sauce Tomate", ing_mozzarella: "Mozzarella", ing_basil: "Basilic", ing_ham: "Jambon Cuit",
            ing_mushrooms: "Champignons", ing_pepperoni: "Pepperoni", ing_gorgonzola: "Gorgonzola", ing_goat: "Ch√®vre", ing_parmesan: "Parmesan",
            ing_creme_fraiche: "Cr√®me Fra√Æche", ing_fromage_blanc: "Fromage Blanc", ing_lardons: "Lardons", ing_onions: "Oignons",
            ing_nutmeg: "Muscade", ing_emmental: "Emmental", ing_munster: "Munster",
            unit_g: "g", unit_ml: "ml", unit_some: "feuilles", unit_pinch: "pinc√©e", unit_slices: "tranches"
        },
        // (Autres langues simplifi√©es pour l'exemple, √† compl√©ter si besoin)
        en: { ui_title: "Pizza Party Planner", btn_add_row: "Add Row", ui_total_list: "Total List", btn_print: "Print", type_pizza: "Pizza", type_tarte: "Flammkuchen" },
        de: { ui_title: "Pizza & Flammkuchen Planer", btn_add_row: "Zeile hinzuf√ºgen", ui_total_list: "Einkaufsliste", btn_print: "Drucken", type_pizza: "Pizza", type_tarte: "Flammkuchen" },
        it: { ui_title: "Pianificatore Pizza", btn_add_row: "Aggiungi riga", ui_total_list: "Lista Spesa", btn_print: "Stampa", type_pizza: "Pizza", type_tarte: "Tarte Flamb√©e" },
        es: { ui_title: "Planificador Pizza", btn_add_row: "A√±adir fila", ui_total_list: "Lista de Compras", btn_print: "Imprimir", type_pizza: "Pizza", type_tarte: "Tarte Flamb√©e" }
    };

    // Pour √©viter d'avoir le code trop long, je fais un fallback anglais pour les autres langues sur les ingr√©dients
    translations.de = {...translations.fr, ...translations.de}; 
    translations.it = {...translations.fr, ...translations.it};
    translations.es = {...translations.fr, ...translations.es};

    const recipeData = {
        pizza: {
            dough: { ing_flour: 150, ing_water: 95, ing_salt: 3, ing_yeast: 1 },
            variants: {
                margherita: { toppings: { ing_sauce_tomato: 80, ing_mozzarella: 100, ing_basil: "unit_some" } },
                reine: { toppings: { ing_sauce_tomato: 80, ing_mozzarella: 80, ing_ham: 50, ing_mushrooms: 40 } },
                pepperoni: { toppings: { ing_sauce_tomato: 80, ing_mozzarella: 80, ing_pepperoni: 40 } },
                fourcheese: { toppings: { ing_sauce_tomato: 50, ing_mozzarella: 40, ing_gorgonzola: 30, ing_goat: 30, ing_parmesan: 20 } }
            }
        },
        tarte: {
            dough: { ing_flour: 120, ing_water: 60, ing_oil: 10, ing_salt: 2 },
            baseTopping: { ing_creme_fraiche: 50, ing_fromage_blanc: 50, ing_onions: 50, ing_nutmeg: "unit_pinch" },
            variants: {
                tradition: { toppings: { ...{ing_lardons: 60} } },
                gratinee: { toppings: { ...{ing_lardons: 60, ing_emmental: 40} } },
                forestiere: { toppings: { ...{ing_lardons: 60, ing_mushrooms: 40} } },
                munster: { toppings: { ...{ing_lardons: 60, ing_munster: 50} } }
            }
        }
    };

    // Pr√©-fusion tartes
    for (const v in recipeData.tarte.variants) {
        recipeData.tarte.variants[v].toppings = { ...recipeData.tarte.baseTopping, ...recipeData.tarte.variants[v].toppings };
    }

    /* --- DOM ELEMENTS --- */
    const containerRows = document.getElementById('order-rows-container');
    const mainImage = document.getElementById('main-image');
    const langSelect = document.getElementById('language-select');
    let currentLang = 'fr';

    /* --- FUNCTIONS --- */

    function createRowHTML(index) {
        // Build Select Options for Type
        const isPizza = index < 2; // Par d√©faut: 2 premi√®res lignes Pizza, suivantes Tarte (juste pour l'exemple)
        const defaultType = isPizza ? 'pizza' : 'tarte';
        
        return `
            <div class="recipe-row" id="row-${index}">
                <div class="control-group">
                    <select class="type-select" onchange="updateRowType(this, ${index}); calculateTotal();">
                        <option value="pizza" ${defaultType === 'pizza' ? 'selected' : ''}>${translations[currentLang].type_pizza}</option>
                        <option value="tarte" ${defaultType === 'tarte' ? 'selected' : ''}>${translations[currentLang].type_tarte}</option>
                    </select>
                </div>
                <div class="control-group">
                    <select class="variant-select" onchange="calculateTotal()">
                        </select>
                </div>
                <div class="control-group">
                    <input type="number" class="count-input" value="${index === 0 ? 4 : 0}" min="0" oninput="calculateTotal()" placeholder="0">
                </div>
                <button class="btn-remove" onclick="removeRow(${index})" title="Supprimer">
                    <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        `;
    }

    function addNewRow() {
        const index = new Date().getTime(); // Unique ID
        containerRows.insertAdjacentHTML('beforeend', createRowHTML(index));
        // Initialize the variant select for this new row
        const newRow = document.getElementById(`row-${index}`);
        updateRowType(newRow.querySelector('.type-select'), index);
        calculateTotal();
    }

    function removeRow(id) {
        const row = document.getElementById(`row-${id}`);
        row.remove();
        calculateTotal();
        updateMainImage(); // Update image in case the first row was removed
    }

    function updateRowType(selectElement, rowId) {
        const row = document.getElementById(`row-${rowId}`);
        const type = selectElement.value;
        const variantSelect = row.querySelector('.variant-select');
        
        // Populate variants based on type
        variantSelect.innerHTML = '';
        const variants = recipeData[type].variants;
        for (const [key, val] of Object.entries(variants)) {
            const opt = document.createElement('option');
            opt.value = key;
            const transKey = 'var_' + key;
            opt.textContent = translations[currentLang][transKey] || key;
            variantSelect.appendChild(opt);
        }
        
        updateMainImage(); // Check if we need to change the top photo
    }

    function updateMainImage() {
        // Find the FIRST row to decide the image
        const firstRow = document.querySelector('.recipe-row');
        if (firstRow) {
            const type = firstRow.querySelector('.type-select').value;
            mainImage.src = IMAGES[type];
        } else {
            mainImage.src = IMAGES['pizza']; // Default
        }
    }

    function calculateTotal() {
        const totalIngredients = {}; // { ing_key: {amount: 100, unit: 'g'} }

        document.querySelectorAll('.recipe-row').forEach(row => {
            const type = row.querySelector('.type-select').value;
            const variant = row.querySelector('.variant-select').value;
            const count = parseInt(row.querySelector('.count-input').value) || 0;

            if (count > 0) {
                // 1. Dough
                const dough = recipeData[type].dough;
                addToTotal(totalIngredients, dough, count);

                // 2. Toppings
                const toppings = recipeData[type].variants[variant].toppings;
                addToTotal(totalIngredients, toppings, count);
            }
        });

        renderTotalTable(totalIngredients);
    }

    function addToTotal(totalObj, ingredients, multiplier) {
        for (const [key, val] of Object.entries(ingredients)) {
            if (!totalObj[key]) totalObj[key] = { amount: 0, unit: '' };

            if (typeof val === 'number') {
                totalObj[key].amount += (val * multiplier);
                // Determine unit
                if (key.includes('water') || key.includes('oil') || key.includes('ml')) {
                    totalObj[key].unit = translations[currentLang].unit_ml;
                } else if (key === 'ing_pepperoni' || key === 'ing_munster' && val < 20) {
                     // Keep vague or assume slices/g depending on implementation
                     totalObj[key].unit = translations[currentLang].unit_g; 
                } else {
                    totalObj[key].unit = translations[currentLang].unit_g;
                }
            } else {
                // It's a text unit (pinch, leaves) - we can't sum mathematically easily
                // For this version, we just show the unit name
                totalObj[key].isSpecial = true;
                totalObj[key].specialKey = val;
            }
        }
    }

    function renderTotalTable(totals) {
        const tbody = document.getElementById('shopping-list-tbody');
        tbody.innerHTML = '';
        
        if (Object.keys(totals).length === 0) {
            tbody.innerHTML = '<tr><td colspan="2" style="text-align:center; color:#999;">Ajoutez des quantit√©s pour voir la liste</td></tr>';
            return;
        }

        for (const [key, data] of Object.entries(totals)) {
            const tr = document.createElement('tr');
            
            const tdName = document.createElement('td');
            tdName.textContent = translations[currentLang][key] || key;
            
            const tdAmount = document.createElement('td');
            tdAmount.className = 'amount-cell';
            
            if (data.isSpecial) {
                tdAmount.textContent = translations[currentLang][data.specialKey] || "";
            } else {
                // Round nicely
                const rounded = Math.round(data.amount * 10) / 10;
                tdAmount.textContent = `${rounded} ${data.unit}`;
            }
            
            tr.appendChild(tdName);
            tr.appendChild(tdAmount);
            tbody.appendChild(tr);
        }
    }

    function updateUILanguage() {
        document.querySelectorAll('[data-i18n]').forEach(el => {
            const key = el.getAttribute('data-i18n');
            if (translations[currentLang][key]) el.textContent = translations[currentLang][key];
        });
        
        // Update all Selects options inside rows
        document.querySelectorAll('.recipe-row').forEach((row, index) => {
            const typeSelect = row.querySelector('.type-select');
            const savedType = typeSelect.value;
            const savedVariant = row.querySelector('.variant-select').value;
            
            typeSelect.options[0].textContent = translations[currentLang].type_pizza;
            typeSelect.options[1].textContent = translations[currentLang].type_tarte;
            
            updateRowType(typeSelect, row.id.split('-')[1]); // Refresh variants text
            row.querySelector('.variant-select').value = savedVariant; // Restore selection
        });

        calculateTotal();
    }

    // --- INITIALIZATION ---
    langSelect.addEventListener('change', (e) => {
        currentLang = e.target.value;
        updateUILanguage();
    });

    // Create 4 initial rows
    for (let i = 0; i < 4; i++) {
        addNewRow();
    }
    // Set some default values for demo
    document.querySelectorAll('.count-input')[0].value = 4; // 4 Pizzas
    document.querySelectorAll('.count-input')[1].value = 0;
    document.querySelectorAll('.count-input')[2].value = 0;
    document.querySelectorAll('.count-input')[3].value = 0;

    calculateTotal();

</script>
</body>
</html>
